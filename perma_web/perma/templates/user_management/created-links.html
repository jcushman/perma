{% extends "admin-layout.html" %}
{% load mptt_tags repeat local_datetime %}

{% block title %} | Perma links{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/jquery-ui-1.10.3.custom.min.js"></script>
    <script src="{{ STATIC_URL }}js/jquery.dotdotdot-1.5.9.min.js"></script>
    <script src="{{ STATIC_URL }}js/jquery.django-csrf.js"></script>
    <script src="{{ STATIC_URL }}js/lib/jstree.min.js"></script>
    <script>
        folderContentsURL = '{% url "folder_contents" folder_id='FOLDER_ID' %}';
    </script>
    <script src="{{ STATIC_URL }}js/links-list.js"></script>
{% endblock %}

{% block styles %}
    {{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/jstree-theme/style.min.css" />
{% endblock %}

{% block content %}

	<h3>Your Perma Links</h3>

    {% comment %}
    {% if path == "/" %}
        <p>
            {% if links %}
                You have {{ link_count }} link{{ link_count|pluralize }}.
                Vested links are marked with <span class="fancy-infinity">&infin;</span>.
            {% else %}
                You haven't saved any links yet.
            {% endif %}
        </p>
    {% endif %}
    {% endcomment %}

    {% include "user_management/includes/search_form.html" %}

    {### create new folder ###}
    <div id="new_folder_container">
        <button type="button" id="new_folder_show" class="btn btn-default"><span class="icon-folder-close-alt" style="font-size: large;"></span> New Folder</button>
    </div>
    <div id="new_folder_name_container" style="display:none">
        <input type="text" name="new_folder_name" id="new_folder_name" placeholder="New folder name" style="margin-bottom: 0;"/>
        <button type="submit" name="action" value="new_folder" id="new_folder_submit" class="btn btn-default" disabled>Create</button>
        <input type="button" id="new_folder_cancel" value="Cancel" class="btn btn-default"/>
    </div>

    <form method="POST">
        {% csrf_token %}

        <div class="row">
            <div class="col-sm-3">


                <div id="folder-tree">
                    <ul>
                        <li data-folder_id="{{ request.user.root_folder.pk }}" class="jstree-clicked jstree-open">home
                            <ul>
                                {% for tree in all_folder_trees %}
                                    {% recursetree tree %}
                                        <li data-folder_id="{{ node.pk }}">{{ node.name }}
                                            {% if not node.is_leaf_node %}
                                                <ul>
                                                    {{ children }}
                                                </ul></li>
                                            {% else %}
                                                </li>
                                            {% endif %}
                                    {% endrecursetree %}
                                {% endfor %}
                            </ul>
                        </li>
                    </ul>
                </div>

                {% if search_query %}
                    <p>
                        <em>
                            Search results {% if not current_folder.is_root_folder %}in {{ current_folder }} folder{% endif %} for "{{ search_query }}".
                            <a href="?q=">Clear search.</a>
                        </em>
                    </p>
                {% endif %}

            </div>
            <div class="col-sm-9">

            <table class="vested-table">
                <thead>
                    <tr>
                        <th colspan="2">Links</th>
                        <th class="linky-abbr-title"><a href="?sort={% if sort == 'submitted_title' %}-{% endif %}submitted_title{% if search_query %}&q={{ search_query }}{% endif %}">Title</a></th>
                        <th class="linky-abbr-date-time"><a href="?sort={% if sort == 'creation_timestamp' %}-{% endif %}creation_timestamp{% if search_query %}&q={{ search_query }}{% endif %}">Created</a></th>
                        <th class="linky-abbr-date-time"><a href="?sort={% if sort == 'vested_timestamp' %}-{% endif %}vested_timestamp{% if search_query %}&q={{ search_query }}{% endif %}">Vested</a></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% include "user_management/includes/created-link-items.html" %}
                </tbody>
            </table>

            {% comment %}
                {% if links.paginator.num_pages > 1 %}
                    <div class="pagination">
                        <ul class="pagination">
                            {% if links.has_previous %}<li><a href="?page={{ links.previous_page_number }}&sort={{ sort }}">&lt;</a></li>{% endif %}
                            {% for i in links.paginator.page_range %}
                            {% ifequal i links.number %}
                            <li class="active"><a href="">{{ i }}</a></li>
                            {% else %}
                            <li><a href="?page={{ i }}">{{ i }}</a></li>
                            {% endifequal %}
                            {% endfor %}
                            {% if links.has_next  %}<li><a href="?page={{ links.next_page_number }}&sort={{ sort }}">&gt;</a></li>{% endif %}
                        </ul>
                    </div>
                {% endif %}
            {% endcomment %}
            </div>
        </div>

    </form>


    {# used by javascript #}
    <div id="form_templates" style="display:none">
        <div class="rename-folder-form">
            <input type="text" name="folder_name"/>
            <input type="button" name="rename_folder_save" value="save" class="btn btn-mini"/>
            <input type="button" name="rename_folder_cancel" value="cancel" class="btn btn-mini"/>
        </div>
    </div>

{% endblock %}

{% block templates %}

    {% verbatim %}
    <script id="upload-confirm-template" type="text/x-handlebars-template">
          <h4 class="text-warning">Upload successful!</h4>
          <p><a href="{{url}}">{{url}}</a></p>
    </script>
    {% endverbatim %}

{% endblock %}